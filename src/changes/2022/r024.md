---
Publish Date: 'YYYY-MM-DD'
---

# Release 2022_024 (unreleased)

## Impact

- nothing yet

## NixOS 22.05 platform

- postgresql: Add {command}`fc-postgresql` with various subcommands for
  listing data directories for all major versions of PostgreSQL and upgrading
  database clusters (a wrapper around `pg_upgrade`). The command has to be
  run as `postgres` user. We also add options for automated database upgrades
  which are experimental and are meant for internal use only in platform code
  at the moment. (#PL-130197).
- Kubernetes/k3s: fix frontend setup issues that occured on NixOS 22.05 in
  some networking scenarios. Load-balancing between pods in HAProxy didn't
  work anymore with the old setup because CoreDNS doesn't allow wildcard DNS
  queries anymore. To see how the frontend has to be configured now for
  load-balancing, look at the first networking scenario and the configuration
  reference in the updated
  [Kubernetes/k3s role documentation](https://doc.flyingcircus.io/roles/fc-22.05-staging/kubernetes.html)
  (#PL-130916).
- mailserver: require explicit PostgreSQL version setting if Roundcube web
  mailer is enabled and enable auto-upgrades: changing to a higher major
  PostgreSQL version will automatically upgrade and migrate existing data.
  Note that it will only work by default when no other databases than
  `roundcube` are present in the database cluster. If there are more
  databases, add them to the list of expected databases, like:
  `flyingcircus.postgresql.autoUpgrade.expectedDatabases =[ "anotherdb" ];`
  (#PL-130600).

## NixOS 21.11 platform

- nothing yet

## NixOS 21.05 platform

- (internal) Add used disk space telemetry for backup server data volumes (#PL-130682).

## NixOS 20.09 platform

- nothing yet

## NixOS 15.09 platform

- nothing yet

## Gentoo platform

- nothing yet

## Documentation

- nothing yet

## Detailed Changes

% vim: set spell spelllang=en:
